{% extends 'base.html'%}

{% block pageheading %}
{{ selected_sub_content_level_name }} - {{ selected_sub_content_material_name }} - {{ selected_sub_content_subject_name }}
{% endblock pageheading %}


{% block content %}
<div class="container">
    <div class="que-coll-top">
        <div class="que-coll-top-left">
            <div class="sub-nav-top">
                <a href="#">
                    <span>Home</span>
                </a>
                <i class="fa-sharp fa-solid fa-angle-right"></i>
                <a href="#">
                    <span>Entrance</span>
                </a>
                <i class="fa-sharp fa-solid fa-angle-right"></i>
                <a href="#">
                    <span>Past Question</span>
                </a>
            </div>
            <div class="error-404-underline que-coll-line"></div>

            {% if sub_content_object_list %}
            <div class="top-bar-view">
                {% for item in sub_content_object_list %}
                <a id="sub_content_object_id{{item.id}}" class="year-tags{% if forloop.first %} active{% endif %}" sub_content_object_data="{{item.id}}">YEAR:{{item.sub_content_name}}</a>
                {% endfor %}
            </div>
            
            <div class="que-coll-left-container" id="subContainer">
                {% if sub_content_object.is_pdf %}
                <div id="pdfContainer" style="position: relative; height: 100vh;" class="que-coll-top-left">
                    <button id="fullscreenButton" style="position: absolute; top: 0; right: 2px;"><i
                            class="fa-solid fa-expand"></i></button>
                    <iframe id="pdfFrame" style="border: 2px solid #232e52  " src="{{sub_content_object.pdf_URL}}"
                        width="100%" height="100%" responsive=true></iframe>
                </div>
                {% else %}
                <div id="subContentContainer">
                {{sub_content_object.content|safe}}
                </div>
                {% endif %}
            </div>
            {% else %}
            <h1>No Data Found!</h1>
            {% endif %}
        </div>
        <div class="que-coll-top-right">
            {% include 'snippet_code/popular_post.html' %}
        </div>
    </div>
    <div class="error-404-underline que-coll-line"></div>

    {% include 'snippet_code/other_related_post.html' %}
</div>
{% if sub_content_object.is_pdf %}
{% include 'snippet_code/snippet_iframe_pdf_view_js.html' %}
{% endif %}
<script>
    $(document).ready(function () {
        $(document).on('click', '[id^="sub_content_object_id"]', function (e) {
            var sub_content_object_id = $(this).attr('sub_content_object_data');   // Retrieve the value of the 'past_question_object_data' attribute for the clicked element
            $.ajax({
                type: 'GET',
                url: '',
                "X-Requested-With": "XMLHttpRequest",
                data: {
                    id: sub_content_object_id        // Pass the 'past_question_object_id' as a parameter in the AJAX request
                },
                success: function (response) {
                    console.log(response.data[0])
                    
                    if(response.data[0].is_pdf == true){
                        url = response.data[0].url

                        $('#subContentContainer').remove()

                        var pdfContainer = document.createElement("div");
                        pdfContainer.setAttribute("id","pdfContainer");
                        pdfContainer.setAttribute("class","que-coll-top-left");
                        pdfContainer.setAttribute("style","position: relative; height: 100vh;")

                        var fullscreenButton = document.createElement("button");
                        fullscreenButton.setAttribute("id","fullscreenButton");
                        fullscreenButton.setAttribute("style","position: absolute; top: 0; right: 2px;");

                        var i = document.createElement("i");
                        i.className = "fa-solid fa-expand"

                        var pdfFrame = document.createElement("iframe");
                        pdfFrame.setAttribute("id","pdfFrame");
                        pdfFrame.setAttribute("style","border: 2px solid #232e52 ");
                        pdfFrame.src = url;
                        pdfFrame.width = "100%";
                        pdfFrame.height = "100%";
                        pdfFrame.responsive = true;

                        
                        pdfContainer.appendChild(fullscreenButton);
                        fullscreenButton.appendChild(i);
                        pdfContainer.appendChild(pdfFrame);

                        if(pdfContainer){
                            $('#pdfContainer').remove();
                            $('#subContainer').append(pdfContainer);
                        }else{
                            $('#subContainer').append(pdfContainer);
                        }

                    }
                    else{
                        content = response.data[0].content

                        $('#pdfContainer').remove()

                        var subContentContainer = document.createElement("div");
                        subContentContainer.id = "subContentContainer"
                        subContentContainer.innerHTML = content;

                        if(subContentContainer){
                            $('#subContentContainer').remove();
                            $('#subContainer').append(subContentContainer);
                        }else{
                            $('#subContainer').append(subContentContainer)
                        }
                    }
                },
                error: function (error) {
                    console.log(error)      // Log any errors that occur during the AJAX request
                }
            })
        });
    });

    $(document).ready(function() {
    // Add click event to year-tags links
    $('.year-tags').click(function() {

        // Remove active class from all links
        $('.year-tags').removeClass('active');
        
        // Add active class to the clicked link
        $(this).addClass('active');
        });
    }); 
</script>
{% endblock content %}